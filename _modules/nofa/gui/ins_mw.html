

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>nofa.gui.ins_mw &mdash; NOFAInsert 0.5 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="search" title="Search" href="../../../search.html"/>
    <link rel="top" title="NOFAInsert 0.5 documentation" href="../../../index.html"/>
        <link rel="up" title="Module code" href="../../index.html"/> 

  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../index.html" class="icon icon-home"> NOFAInsert
          

          
            
            <img src="../../../_static/nofainsert.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../user-manual.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer-manual.html">Developer Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../index.html">NOFAInsert</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      
    <li>nofa.gui.ins_mw</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for nofa.gui.ins_mw</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">/***************************************************************************</span>
<span class="sd"> InsMw</span>
<span class="sd">                                 A QGIS plugin</span>
<span class="sd"> Insert fish occurrence data to NOFA DB</span>
<span class="sd">                             -------------------</span>
<span class="sd">        begin                : 2017-01-09</span>
<span class="sd">        git sha              : $Format:%H$</span>
<span class="sd">        copyright            : (C) 2017 by NINA</span>
<span class="sd">        contributors         : stefan.blumentrath@nina.no</span>
<span class="sd">                               matteo.destefano@nina.no</span>
<span class="sd">                               jakob.miksch@nina.no</span>
<span class="sd">                               ondrej.svoboda@nina.no</span>
<span class="sd"> ***************************************************************************/</span>

<span class="sd">/***************************************************************************</span>
<span class="sd"> *                                                                         *</span>
<span class="sd"> *   This program is free software; you can redistribute it and/or modify  *</span>
<span class="sd"> *   it under the terms of the GNU General Public License as published by  *</span>
<span class="sd"> *   the Free Software Foundation; either version 2 of the License, or     *</span>
<span class="sd"> *   (at your option) any later version.                                   *</span>
<span class="sd"> *                                                                         *</span>
<span class="sd"> ***************************************************************************/</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">qgis.core</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">QgsApplication</span><span class="p">,</span> <span class="n">QgsMessageLog</span><span class="p">,</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">,</span>
    <span class="n">QgsCoordinateTransform</span><span class="p">,</span> <span class="n">QgsPoint</span><span class="p">,</span> <span class="n">QgsRasterLayer</span><span class="p">,</span> <span class="n">QgsMapLayerRegistry</span><span class="p">,</span>
    <span class="n">QgsVectorLayer</span><span class="p">,</span> <span class="n">QgsDataSourceURI</span><span class="p">,</span> <span class="n">QgsProject</span><span class="p">,</span> <span class="n">QgsFeature</span><span class="p">,</span> <span class="n">QgsGeometry</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">qgis.gui</span> <span class="k">import</span> <span class="n">QgsMapToolEmitPoint</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="k">import</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">uic</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtCore</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">QSettings</span><span class="p">,</span> <span class="n">QCoreApplication</span><span class="p">,</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">QDate</span><span class="p">,</span> <span class="n">QDateTime</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span>
    <span class="n">QSignalMapper</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">PyQt4.QtGui</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QTreeWidgetItem</span><span class="p">,</span> <span class="n">QListWidgetItem</span><span class="p">,</span> <span class="n">QTableWidget</span><span class="p">,</span>
    <span class="n">QTableWidgetItem</span><span class="p">,</span> <span class="n">QMainWindow</span><span class="p">,</span> <span class="n">QDoubleValidator</span><span class="p">,</span> <span class="n">QIntValidator</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span>
    <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">,</span> <span class="n">QAbstractItemView</span><span class="p">,</span> <span class="n">QValidator</span><span class="p">,</span> <span class="n">QBrush</span><span class="p">,</span> <span class="n">QColor</span><span class="p">,</span>
    <span class="n">QPlainTextEdit</span><span class="p">,</span> <span class="n">QTextCursor</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">OrderedDict</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">psycopg2</span>
<span class="kn">import</span> <span class="nn">psycopg2.extras</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">de</span>
<span class="kn">import</span> <span class="nn">dtst_dlg</span>
<span class="kn">import</span> <span class="nn">prj_dlg</span>
<span class="kn">import</span> <span class="nn">ref_dlg</span>
<span class="kn">import</span> <span class="nn">vald</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">db</span><span class="p">,</span> <span class="n">ordered_set</span>


<span class="k">class</span> <span class="nc">ActLyrExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when there is no active layer.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">LocLyrSrcExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when a layer source is not `nofa.location`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">SelFeatExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when there are no selected features.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">MtdtNotFldExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when a metadata mandatory widget is not filled.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wdg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param nf_nvl: A widget that is not filled/selected.</span>
<span class="sd">        :type nf_nvl: QWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wdg</span> <span class="o">=</span> <span class="n">wdg</span>


<span class="k">class</span> <span class="nc">OccNotFldExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when a mandatory field in occurrence row is not filled.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">NoLocExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when no location is provided.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">LocidTxtExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when there is a problem</span>
<span class="sd">    with format of `locationID` location text.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">NvlTxtExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when there is a problem</span>
<span class="sd">    with format of `Norwegian VatLnr` location text.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">CoorTxtExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when there is a problem</span>
<span class="sd">    with format of `coordinates` location text.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">LocidMtyExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when location ID is empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>


<span class="k">class</span> <span class="nc">LocidFmtExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when format of location ID is not *uuid.UUID*.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">locid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        :param locid: A location ID.</span>
<span class="sd">        :type locid: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locid</span> <span class="o">=</span> <span class="n">locid</span>


<span class="k">class</span> <span class="nc">LocidNfExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when location ID was not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">locid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        :param locid: A location ID.</span>
<span class="sd">        :type locid: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locid</span> <span class="o">=</span> <span class="n">locid</span>


<span class="k">class</span> <span class="nc">CoorMtyExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when coordinate is empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>


<span class="k">class</span> <span class="nc">NvlMtyExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when Norwegian VatLnr is empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>


<span class="k">class</span> <span class="nc">NvlNfExc</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A custom exception when Norwegian VatLnr was not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">nvl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        :param nvl: Norwegian VatLnr(s) that was/were not found.</span>
<span class="sd">        :type nvl: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">m</span> <span class="o">=</span> <span class="n">m</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nvl</span> <span class="o">=</span> <span class="n">nvl</span>


<span class="n">FORM_CLASS</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s1">&#39;ins_mw.ui&#39;</span><span class="p">))</span>


<div class="viewcode-block" id="InsMw"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw">[docs]</a><span class="k">class</span> <span class="nc">InsMw</span><span class="p">(</span><span class="n">QMainWindow</span><span class="p">,</span> <span class="n">FORM_CLASS</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A main window for inserting data into NOFA database.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iface</span><span class="p">,</span> <span class="n">mc</span><span class="p">,</span> <span class="n">plugin_dir</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Constructor.</span>

<span class="sd">        :param iface: A reference to the QgisInterface.</span>
<span class="sd">        :type iface: QgisInterface</span>
<span class="sd">        :param mc: A reference to the main class.</span>
<span class="sd">        :type mc: object</span>
<span class="sd">        :param plugin_dir: A plugin directory.</span>
<span class="sd">        :type plugin_dir: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">InsMw</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="c1"># set up the user interface from Designer.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">iface</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span> <span class="o">=</span> <span class="n">mc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span> <span class="o">=</span> <span class="n">plugin_dir</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_self</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_setup_self</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets up self.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">org</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;NINA&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;NOFAInsert - </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">db_str</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">QSettings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">org</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loctp_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">u</span><span class="s1">&#39;Norwegian VatnLnr&#39;</span><span class="p">:</span> <span class="s1">&#39;no_vatn_lnr&#39;</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;coordinates UTM32&#39;</span><span class="p">:</span> <span class="mi">25832</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;coordinates UTM33&#39;</span><span class="p">:</span> <span class="mi">25833</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">crs_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([</span>
            <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;UTM32&#39;</span><span class="p">,</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="s1">&#39;EPSG:25832&#39;</span><span class="p">)),</span>
            <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;UTM33&#39;</span><span class="p">,</span> <span class="n">QgsCoordinateReferenceSystem</span><span class="p">(</span><span class="s1">&#39;EPSG:25833&#39;</span><span class="p">))])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">u</span><span class="s1">&#39;locationID&#39;</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">opt_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sa">u</span><span class="s1">&#39;new&#39;</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;nearest&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dash_split_str</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39; - &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">at_split_str</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;@&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_str</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;&lt;all&gt;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;&lt;select&gt;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">forbi_str_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">today_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nxt_week_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">today_dt</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fltr_str_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># self.def_clr = self.ins_btn.palette().background().color()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grn_clr</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">177</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">177</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">red_clr</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">234</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">177</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yel_clr</span> <span class="o">=</span> <span class="n">QColor</span><span class="p">(</span><span class="mi">234</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">177</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_wdgs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds and sets up own widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_build_main_tab_wdgs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_hist_tab_wdgs</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_tabwdg</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_tabwdg</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_swdg</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_loc_tbl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_occ_tbl</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_con_main_tab_wdgs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_hist_tab_wdgs</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_build_main_tab_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds and sets up widgets in main tab.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># event - dateStart</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtstrt_mde</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">MtyDe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtstrt_mde</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;dtstrt_mde&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtstrt_mde</span><span class="o">.</span><span class="n">setDisplayFormat</span><span class="p">(</span><span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_grid_lyt</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtstrt_mde</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># event - dateEnd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtend_mde</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">MtyDe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtend_mde</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;dtend_mde&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtend_mde</span><span class="o">.</span><span class="n">setDisplayFormat</span><span class="p">(</span><span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_grid_lyt</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtend_mde</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># occurrence - verifiedDate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verdt_mde</span> <span class="o">=</span> <span class="n">de</span><span class="o">.</span><span class="n">MtyDe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verdt_mde</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;verdt_mde&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verdt_mde</span><span class="o">.</span><span class="n">setDisplayFormat</span><span class="p">(</span><span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_grid_lyt</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verdt_mde</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># dictionary - widget: occurrence table header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl_wdg_hdr_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;method&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_locid_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;locationID&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_crs_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;CRS&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_opt_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;option&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_x_coor_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_y_coor_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_verloc_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;verbatimLocality&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_nvl_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;NVL&#39;</span><span class="p">)])</span>

        <span class="c1"># validators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smpsv_le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QIntValidator</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smpe_le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QIntValidator</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oq_le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QDoubleValidator</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_x_coor_le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QDoubleValidator</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_y_coor_le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QDoubleValidator</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_nvl_le</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">QIntValidator</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">event_input_wdgs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smpp_cb</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smpsu_cb</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smpsv_le</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smpe_le</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtstrt_mde</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtend_mde</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fldnum_le</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rcdby_le</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventrmk_le</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relia_cb</span><span class="p">]</span>

        <span class="c1"># dictionary - widget: occurrence table header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl_wdg_hdr_dict</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txn_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;taxon&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ectp_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;ecotype&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oqt_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;organismQuantityType&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oq_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;organismQuantity&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occstat_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;occurrenceStatus&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poptrend_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;populationTrend&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recnum_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;recordNumber&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occrmk_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;occurrenceRemarks&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estm_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;establishmentMeans&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">estrmk_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;establishmentRemarks&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spwnc_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;spawningCondition&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spwnl_cb</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;spawningLocation&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vfdby_le</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;verifiedBy&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">verdt_mde</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;verifiedDate&#39;</span><span class="p">)])</span>

        <span class="c1"># tool for setting coordinates by left mouse click</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_cnvs_tool</span> <span class="o">=</span> <span class="n">QgsMapToolEmitPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cnvs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coord_cnvs_tool</span><span class="o">.</span><span class="n">canvasClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_cnvs_coord_to_loc_tbl</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_load_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">occ_mand_wdgs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">txn_cb</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">occstat_cb</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estm_cb</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mtdt_mand_wdgs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smpp_cb</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtend_mde</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rcdby_le</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtst_cb</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj_cb</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">all_mand_wdgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_mand_wdgs</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">mtdt_mand_wdgs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_mand_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">all_mand_wdgs</span><span class="p">)</span>

        <span class="c1"># self.main_hspltr.setStretchFactor(0, 1)</span>
        <span class="c1"># self.main_hspltr.setStretchFactor(1, 2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_hspltr</span><span class="o">.</span><span class="n">setStretchFactor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_hspltr</span><span class="o">.</span><span class="n">setStretchFactor</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_hist_tab_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds and sets up widgets in history tab.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># connect date edits min and max dates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtstrt_de</span><span class="o">.</span><span class="n">dateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtend_de</span><span class="o">.</span><span class="n">setMinimumDate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtend_de</span><span class="o">.</span><span class="n">dateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtstrt_de</span><span class="o">.</span><span class="n">setMaximumDate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtstrt_de</span><span class="o">.</span><span class="n">dateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtend_de</span><span class="o">.</span><span class="n">setMinimumDate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtend_de</span><span class="o">.</span><span class="n">dateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtstrt_de</span><span class="o">.</span><span class="n">setMaximumDate</span><span class="p">)</span>

        <span class="c1"># set date edits&#39; dates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtstrt_de</span><span class="o">.</span><span class="n">setDate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fltr_str_dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtend_de</span><span class="o">.</span><span class="n">setDate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">today_dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtstrt_de</span><span class="o">.</span><span class="n">setDate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fltr_str_dt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtend_de</span><span class="o">.</span><span class="n">setDate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">today_dt</span><span class="p">)</span>

        <span class="c1"># dictionary for updating history tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hist_tbls_fnc_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_occ_tbl</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">get_hist_occ_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_loc_tbl</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">get_hist_loc_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_event_tbl</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">get_hist_event_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_dtst_tbl</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">get_hist_dtst_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_prj_tbl</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">get_hist_prj_list</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_ref_tbl</span><span class="p">:</span> <span class="n">db</span><span class="o">.</span><span class="n">get_hist_ref_list</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hist_input_wdgs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usr_cb</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtstrt_de</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtend_de</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtstrt_de</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtend_de</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_create_loc_tbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an occurrence table with one row.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_tbl_main_tab</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upd_loc_tbl_item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_occ_tbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates an occurrence table with one row.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_create_tbl_main_tab</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upd_occ_tbl_item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_con_main_tab_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects main tab widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_tabwdg</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fetch_schema</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_con_loc_wdgs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_mtdt_wdgs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_con_occ_wdgs</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txncvg_tw</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upd_txncvg_tw_chldn</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rst_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ins_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ins</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_con_loc_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects location widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wb_le</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_srch_loc</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cntry_code_cb</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pop_cnty_cb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnty_cb</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pop_muni_cb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_srch_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_srch_loc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_load_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_load_loc_lyr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_seld_feats_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_locid_seld_feats</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">osm_basemap_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_osm_wms_lyr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_coord_cnvs_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_act_coord_cnvs_tool</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_met_cb</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upd_loc_manual_swdg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_met_cb</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_met_cb</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_locid_add_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_manual_locid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_coor_add_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_manual_coor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_nvl_add_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_manual_nvl</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_cb</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upd_loc_tbl_row</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upd_loc_tbl_wdgs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_tabwdg</span><span class="o">.</span><span class="n">currentChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upd_loc_tbl_wdgs</span><span class="p">)</span>

        <span class="c1"># table buttons - connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_rowup_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sel_row_up</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_rowdwn_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sel_row_dwn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_addrow_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_tbl_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_delrow_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_del_tbl_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_rstrow_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rst_tbl_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_rstallrows_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rst_all_tbl_rows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_del_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_del_all_tbl_rows</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">preview_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_preview_loc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_con_mtdt_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects metadata widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">adddtst_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_dtst_dlg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addprj_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_prj_dlg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addref_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_ref_dlg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dtst_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upd_mtdt_lw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upd_mtdt_lw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_cb</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upd_mtdt_lw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_con_occ_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects occurrence widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txn_cb</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pop_ectp_cb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_upd_occ_tbl_wdgs</span><span class="p">)</span>

        <span class="c1"># table buttons - connect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_rowup_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sel_row_up</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_rowdwn_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sel_row_dwn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_addrow_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_add_tbl_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_delrow_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_del_tbl_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_rstrow_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rst_tbl_row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_rstallrows_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rst_all_tbl_rows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_del_btn</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_del_all_tbl_rows</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_con_hist_tab_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects history tab widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_con_wdgs_sgnls_to_met</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hist_input_wdgs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_hist_tbls</span><span class="p">)</span>

<div class="viewcode-block" id="InsMw.set_mand_wdgs"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.set_mand_wdgs">[docs]</a>    <span class="k">def</span> <span class="nf">set_mand_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wdgs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets mandatory widgets. Mandatory widgets have predefined color</span>
<span class="sd">        when they are not filled/selected.</span>

<span class="sd">            - *QLineEdit* -- must contain at least one</span>
<span class="sd">            - *QComboBox* -- selected value can not be in list of forbidden</span>
<span class="sd">              strings</span>
<span class="sd">            - *QDateEdit* -- user must edit (click) on it at least once</span>

<span class="sd">        :param wdgs: A list of widgets to be set as mandatory.</span>
<span class="sd">        :type wdgs: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wdg</span> <span class="ow">in</span> <span class="n">wdgs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">setValidator</span><span class="p">(</span><span class="n">vald</span><span class="o">.</span><span class="n">LenTxtVald</span><span class="p">(</span><span class="n">wdg</span><span class="p">))</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chck_state_text</span><span class="p">)</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chck_state_text</span><span class="p">)</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">dateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_chck_state_text</span><span class="p">)</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">dateChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">date</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">_chck_state_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks a sender&#39;s state or text and sets its background color</span>
<span class="sd">        accordingly.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sndr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sndr</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">):</span>
            <span class="n">valr</span> <span class="o">=</span> <span class="n">sndr</span><span class="o">.</span><span class="n">validator</span><span class="p">()</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">valr</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">sndr</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sndr</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">sndr</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">txt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">QValidator</span><span class="o">.</span><span class="n">Invalid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">QValidator</span><span class="o">.</span><span class="n">Acceptable</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sndr</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">sndr</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">QLineEdit</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">txt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">QValidator</span><span class="o">.</span><span class="n">Invalid</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">QValidator</span><span class="o">.</span><span class="n">Acceptable</span>
        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QValidator</span><span class="o">.</span><span class="n">Intermediate</span> <span class="ow">or</span> <span class="n">state</span> <span class="o">==</span> <span class="n">QValidator</span><span class="o">.</span><span class="n">Invalid</span><span class="p">:</span>
            <span class="n">clr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">red_clr</span>
            <span class="n">stl</span> <span class="o">=</span> <span class="s1">&#39;background-color: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">clr</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stl</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">sndr</span><span class="o">.</span><span class="n">setStyleSheet</span><span class="p">(</span><span class="n">stl</span><span class="p">)</span>

<div class="viewcode-block" id="InsMw.chck_mand_wdgs"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.chck_mand_wdgs">[docs]</a>    <span class="k">def</span> <span class="nf">chck_mand_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mand_wdgs</span><span class="p">,</span> <span class="n">exc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the given mandatory widgets are filled.</span>

<span class="sd">        :param mand_wdgs: A list of mandatory widgets.</span>
<span class="sd">        :type mand_wdgs: list</span>
<span class="sd">        :param exc: An exception that should be raised.</span>
<span class="sd">        :type exc: Exception</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wdg</span> <span class="ow">in</span> <span class="n">mand_wdgs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">):</span>
                <span class="n">valr</span> <span class="o">=</span> <span class="n">wdg</span><span class="o">.</span><span class="n">validator</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">valr</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">text</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">QValidator</span><span class="o">.</span><span class="n">Acceptable</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">exc</span><span class="p">(</span><span class="n">wdg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">wdg</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">exc</span><span class="p">(</span><span class="n">wdg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">wdg</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">QLineEdit</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">exc</span><span class="p">(</span><span class="n">wdg</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_upd_loc_manual_swdg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets index of location manual stacked widget.</span>
<span class="sd">        Also resets all input widgets.</span>

<span class="sd">        :param idx: A current index of location manual method combo box.</span>
<span class="sd">        :type idx: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_swdg</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cur_loc_manual_tbl_wdgs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_osm_wms_lyr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds OpenStreetMap WMS layer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xml_fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span><span class="p">,</span> <span class="s1">&#39;nofa&#39;</span><span class="p">,</span> <span class="s1">&#39;wms&#39;</span><span class="p">,</span> <span class="s1">&#39;osm.xml&#39;</span><span class="p">)</span>

        <span class="n">lyr</span> <span class="o">=</span> <span class="n">QgsRasterLayer</span><span class="p">(</span><span class="n">xml_fp</span><span class="p">,</span> <span class="s1">&#39;OSM&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lyr</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">QgsMapLayerRegistry</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">lyr</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="n">lyr_count</span> <span class="o">=</span> <span class="n">QgsMapLayerRegistry</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

            <span class="n">lyr_root</span> <span class="o">=</span> <span class="n">QgsProject</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">layerTreeRoot</span><span class="p">()</span>
            <span class="n">lyr_root</span><span class="o">.</span><span class="n">insertLayer</span><span class="p">(</span><span class="n">lyr_count</span><span class="p">,</span> <span class="n">lyr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_srch_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Searches for location.</span>
<span class="sd">        Data are filtered based on information in widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wb</span><span class="p">,</span> <span class="n">cntry_code</span><span class="p">,</span> <span class="n">cnty</span><span class="p">,</span> <span class="n">muni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loc_fltrs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_load_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">locid_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_loc_by_fltrs</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">wb</span><span class="p">,</span> <span class="n">cntry_code</span><span class="p">,</span> <span class="n">cnty</span><span class="p">,</span> <span class="n">muni</span><span class="p">)</span>

        <span class="n">loc_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locid_list</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">loc_count</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_load_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">locid_list</span> <span class="o">=</span> <span class="n">locid_list</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_lyr_name</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;location-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">wb</span><span class="p">,</span> <span class="n">cntry_code</span><span class="p">,</span> <span class="n">cnty</span><span class="p">,</span> <span class="n">muni</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_load_btn</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lake_name_statlbl</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span>
            <span class="sa">u</span><span class="s1">&#39;Found </span><span class="si">{}</span><span class="s1"> location(s).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">loc_count</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_val_txt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">forbi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a validated text.</span>

<span class="sd">        :param txt: A text to be validated.</span>
<span class="sd">        :type txt: str</span>
<span class="sd">        :param forbi: True to allow forbidden text, False otherwise.</span>
<span class="sd">        :type forbi: bool</span>
<span class="sd">        :param all: True to allow all text, False otherwise.</span>
<span class="sd">        :type all: bool</span>

<span class="sd">        :returns: A filter, None when text is in list of forbidden strings</span>
<span class="sd">            or when length of text is zero.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">forbi</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">txt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forbi_str_list</span><span class="p">:</span>
            <span class="n">val_txt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">all</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">txt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_str</span><span class="p">:</span>
            <span class="n">val_txt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">val_txt</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val_txt</span> <span class="o">=</span> <span class="n">txt</span>

        <span class="k">return</span> <span class="n">val_txt</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_loc_fltrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns location filters.</span>
<span class="sd">        It is used to filter locations.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A tuple containing:</span>
<span class="sd">         |    - *str* -- water body</span>
<span class="sd">         |    - *str* -- country code</span>
<span class="sd">         |    - *str* -- county</span>
<span class="sd">         |    - *str* -- municipality</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wb</span>
        <span class="n">cntry_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cntry_code</span>
        <span class="n">cnty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnty</span>
        <span class="n">muni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_muni</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">cntry_code</span><span class="p">,</span> <span class="n">cnty</span><span class="p">,</span> <span class="n">muni</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_wb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a water body from water body line edit.</span>
<span class="sd">        Returns None when there is no text in the line edit.</span>

<span class="sd">        :returns: A water body, None when there is no text in the line edit.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wb_le</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="n">wb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wb</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_cntry_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a country code from country code combo box.</span>

<span class="sd">        :returns: A country code, None when text is equal to `&lt;all&gt;` string</span>
<span class="sd">            or when length of text is zero.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cntry_code_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">cntry_code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cntry_code</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_cnty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a county from county combo box.</span>

<span class="sd">        :returns: A county, None when text is equal to `&lt;all&gt;` string</span>
<span class="sd">            or when length of text is zero.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnty_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">cnty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cnty</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_muni</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a municipality from municipality combo box.</span>

<span class="sd">        :returns: A municipality, None when text is equal to `&lt;all&gt;` string</span>
<span class="sd">            or when length of text is zero.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">muni_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">muni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">muni</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_txn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a taxon from taxon combo box.</span>

<span class="sd">        :returns: A taxon, None when text is equal to `&lt;all&gt;` string</span>
<span class="sd">            or when length of text is zero.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">txn_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">txn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">txn</span>

    <span class="k">def</span> <span class="nf">_load_loc_lyr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Loads a layer containing found locations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wb</span><span class="p">,</span> <span class="n">cntry_code</span><span class="p">,</span> <span class="n">cnty</span><span class="p">,</span> <span class="n">muni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loc_fltrs</span>

        <span class="n">loc_lyr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_loc_lyr</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locid_list</span><span class="p">,</span>
            <span class="sa">u</span><span class="s1">&#39;search_location-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">wb</span><span class="p">,</span> <span class="n">cntry_code</span><span class="p">,</span> <span class="n">cnty</span><span class="p">,</span> <span class="n">muni</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">loc_lyr</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
            <span class="n">QgsMapLayerRegistry</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">loc_lyr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_loc_lyr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locid_list</span><span class="p">,</span> <span class="n">loc_lyr_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location layer containing features with the given</span>
<span class="sd">        location IDs.</span>
<span class="sd">        The name of the returned location layer is set according to the given</span>
<span class="sd">        name.</span>

<span class="sd">        :param locid_list: A list of location IDs.</span>
<span class="sd">        :type locid_list: list</span>
<span class="sd">        :param loc_lyr_name: A location layer name.</span>
<span class="sd">        :type loc_lyr_name: str</span>

<span class="sd">        :returns: A location layer containing features with the given</span>
<span class="sd">            location IDs.</span>
<span class="sd">        :rtype: QgsVectorLayer</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">uri</span> <span class="o">=</span> <span class="n">QgsDataSourceURI</span><span class="p">()</span>

        <span class="n">con_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con_info</span>

        <span class="n">uri</span><span class="o">.</span><span class="n">setConnection</span><span class="p">(</span>
            <span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">host_str</span><span class="p">],</span>
            <span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">port_str</span><span class="p">],</span>
            <span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">db_str</span><span class="p">],</span>
            <span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">usr_str</span><span class="p">],</span>
            <span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">pwd_str</span><span class="p">])</span>

        <span class="n">uri</span><span class="o">.</span><span class="n">setDataSource</span><span class="p">(</span>
            <span class="s1">&#39;nofa&#39;</span><span class="p">,</span>
            <span class="s1">&#39;location&#39;</span><span class="p">,</span>
            <span class="s1">&#39;geom&#39;</span><span class="p">,</span>
            <span class="s1">&#39;&quot;locationID&quot; IN (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;</span><span class="se">\&#39;</span><span class="si">{}</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">locid_list</span><span class="p">])),</span>
            <span class="s1">&#39;locationID&#39;</span><span class="p">)</span>

        <span class="n">loc_lyr</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span><span class="n">uri</span><span class="o">.</span><span class="n">uri</span><span class="p">(),</span> <span class="n">loc_lyr_name</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;postgres&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loc_lyr</span>

    <span class="k">def</span> <span class="nf">_add_locid_seld_feats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds location IDs of selected features to the location table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">lyr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">activeLayer</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_chck_lyr</span><span class="p">(</span><span class="n">lyr</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lyr</span><span class="o">.</span><span class="n">selectedFeatureCount</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SelFeatExc</span><span class="p">()</span>

            <span class="n">sel_feats</span> <span class="o">=</span> <span class="n">lyr</span><span class="o">.</span><span class="n">selectedFeaturesIterator</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">sel_feats</span><span class="p">:</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="s1">&#39;locationID&#39;</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_set_loc_tbl_row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_locid_list</span><span class="p">(</span><span class="nb">id</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">ActLyrExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;No Active Layer&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;There is no active layer.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">LocLyrSrcExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Layer Source&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Source of active layer is not &quot;nofa.location&quot;.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">SelFeatExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Selected Features&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;There are no selected features.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_chck_lyr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lyr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the given layer is a from `nofa.location` table.</span>

<span class="sd">        :param lyr: A layer to be checked.</span>
<span class="sd">        :type lyr: QgsVectorLayer</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">uri</span> <span class="o">=</span> <span class="n">QgsDataSourceURI</span><span class="p">(</span><span class="n">lyr</span><span class="o">.</span><span class="n">source</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ActLyrExc</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">uri</span><span class="o">.</span><span class="n">schema</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;nofa&#39;</span> <span class="ow">or</span> <span class="n">uri</span><span class="o">.</span><span class="n">table</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;location&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LocLyrSrcExc</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_locid_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location ID list that is used to populate location table.</span>

<span class="sd">        :param id: A location ID.</span>
<span class="sd">        :type id: str</span>

<span class="sd">        :returns: A location ID list.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">locid_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl_wdg_hdr_dict</span><span class="p">)</span>

        <span class="n">locid_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">locid_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>

        <span class="k">return</span> <span class="n">locid_list</span>

    <span class="k">def</span> <span class="nf">_extr_locid_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locid_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts data from location ID list.</span>

<span class="sd">        :param locid_list: A location ID list.</span>
<span class="sd">        :type locid_list: list</span>

<span class="sd">        :returns: A location ID.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">locid</span> <span class="o">=</span> <span class="n">locid_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">locid</span>

    <span class="k">def</span> <span class="nf">_get_coor_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crs_desc</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verb_loc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a coordinates list that is used to populate location table.</span>

<span class="sd">        :param crs_desc: A CRS description.</span>
<span class="sd">        :type crs_desc: str</span>
<span class="sd">        :param opt: An option.</span>
<span class="sd">        :type opt: str</span>
<span class="sd">        :param x: X coordinate.</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: Y coordinate.</span>
<span class="sd">        :type y: float.</span>
<span class="sd">        :param verb_loc: A verbatim locality.</span>
<span class="sd">        :type verb_loc: str</span>

<span class="sd">        :returns: A coordinates list.</span>
<span class="sd">        :rtype: list.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">coor_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl_wdg_hdr_dict</span><span class="p">)</span>

        <span class="n">coor_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">coor_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">crs_desc</span>
        <span class="n">coor_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt</span>
        <span class="n">coor_list</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">coor_list</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">coor_list</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">verb_loc</span>

        <span class="k">return</span> <span class="n">coor_list</span>

    <span class="k">def</span> <span class="nf">_extr_coor_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coor_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts data from coordinates list.</span>

<span class="sd">        :param coor_list: A coordinates list.</span>
<span class="sd">        :type coor_list: list</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A tuple containing:</span>
<span class="sd">         |    - *str* -- CRS description,</span>
<span class="sd">         |    - *str* -- option</span>
<span class="sd">         |    - *float* -- X coordinate</span>
<span class="sd">         |    - *float* -- Y coordinate</span>
<span class="sd">         |    - *str* -- verbatim locality</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">crs_desc</span> <span class="o">=</span> <span class="n">coor_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">coor_list</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coor_list</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coor_list</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">verb_loc</span> <span class="o">=</span> <span class="n">coor_list</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">crs_desc</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verb_loc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_nvl_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nvl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a `Norwegian VatnLnr` list that is used to populate location</span>
<span class="sd">        table.</span>

<span class="sd">        :param nvl: A `Norwegian VatnLnr`.</span>
<span class="sd">        :type nvl: int</span>

<span class="sd">        :returns: A `Norwegian VatnLnr` list.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nvl_list</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl_wdg_hdr_dict</span><span class="p">)</span>

        <span class="n">nvl_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">nvl_list</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nvl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nvl_list</span>

    <span class="k">def</span> <span class="nf">_extr_nvl_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nvl_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts data from `Norwegian VatnLnr` list.</span>

<span class="sd">        :param nvl_list: A `Norwegian VatnLnr` list.</span>
<span class="sd">        :type nvl_list: list</span>

<span class="sd">        :returns: A `Norwegian VatnLnr`.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nvl</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nvl_list</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">nvl</span>

<div class="viewcode-block" id="InsMw.dsc_from_iface"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.dsc_from_iface">[docs]</a>    <span class="k">def</span> <span class="nf">dsc_from_iface</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disconnects the plugin from the QGIS interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">mapTool</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_cnvs_tool</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">unsetMapTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_cnvs_tool</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">setMapTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_map_tool</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_act_coord_cnvs_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Activates a tool that allows user to set coordinates by mouse click.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_map_tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">mapTool</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iface</span><span class="o">.</span><span class="n">mapCanvas</span><span class="p">()</span><span class="o">.</span><span class="n">setMapTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coord_cnvs_tool</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_cnvs_coord_to_loc_tbl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pnt</span><span class="p">,</span> <span class="n">btn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets canvas coordinates to the location table.</span>
<span class="sd">        It transforms coordinates to the current CRS.</span>
<span class="sd">        Coordinates are set only on left mouse click.</span>

<span class="sd">        :param pnt: A point.</span>
<span class="sd">        :type pnt: QgsPoint</span>
<span class="sd">        :param btn: A mouse button.</span>
<span class="sd">        :type btn: QtCore.MouseButton</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">row_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_row_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">())</span>

        <span class="c1"># set coordinates only on left mouse click</span>
        <span class="c1"># and when method of current row is &#39;coordinates&#39;</span>
        <span class="k">if</span> <span class="n">btn</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span> <span class="ow">and</span> <span class="n">row_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">in_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnvs</span><span class="o">.</span><span class="n">mapSettings</span><span class="p">()</span><span class="o">.</span><span class="n">destinationCrs</span><span class="p">()</span>

            <span class="n">crs_desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edit_crs_desc</span>
            <span class="n">out_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs_dict</span><span class="p">[</span><span class="n">crs_desc</span><span class="p">]</span>

            <span class="n">in_x</span> <span class="o">=</span> <span class="n">pnt</span><span class="o">.</span><span class="n">x</span><span class="p">()</span>
            <span class="n">in_y</span> <span class="o">=</span> <span class="n">pnt</span><span class="o">.</span><span class="n">y</span><span class="p">()</span>

            <span class="n">out_x</span><span class="p">,</span> <span class="n">out_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trf_coord</span><span class="p">(</span><span class="n">in_crs</span><span class="p">,</span> <span class="n">out_crs</span><span class="p">,</span> <span class="n">in_x</span><span class="p">,</span> <span class="n">in_y</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_x_coor_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">out_x</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_y_coor_le</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">out_y</span><span class="p">))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_edit_crs_desc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an edit CRS description.</span>

<span class="sd">        :returns: An edit CRS description.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">crs_desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_crs_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">crs_desc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_manual_crs_desc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a manual CRS description.</span>

<span class="sd">        :returns: A manual CRS description.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">crs_desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_coor_crs_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">crs_desc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_edit_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an edit option.</span>

<span class="sd">        :returns: An edit option.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_opt_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">opt</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_manual_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a manual option.</span>

<span class="sd">        :returns: A manual option.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_coor_opt_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">opt</span>

    <span class="k">def</span> <span class="nf">_trf_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_crs</span><span class="p">,</span> <span class="n">out_crs</span><span class="p">,</span> <span class="n">in_x</span><span class="p">,</span> <span class="n">in_y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Transforms the given X and Y coordinates from the input CRS</span>
<span class="sd">        to the output CRS.</span>

<span class="sd">        :param in_crs: An input CRS.</span>
<span class="sd">        :type in_crs: QgsCoordinateReferenceSystem</span>
<span class="sd">        :param out_crs: An Output CRS.</span>
<span class="sd">        :type out_crs: QgsCoordinateReferenceSystem</span>
<span class="sd">        :param in_x: An input X coordinate.</span>
<span class="sd">        :type in_x: float</span>
<span class="sd">        :param in_y: An input Y coordinate.</span>
<span class="sd">        :type in_y: float</span>

<span class="sd">        :returns: X and Y coordinates in the output CRS.</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">trf</span> <span class="o">=</span> <span class="n">QgsCoordinateTransform</span><span class="p">(</span><span class="n">in_crs</span><span class="p">,</span> <span class="n">out_crs</span><span class="p">)</span>

        <span class="n">out_x</span><span class="p">,</span> <span class="n">out_y</span> <span class="o">=</span> <span class="n">trf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="n">in_x</span><span class="p">,</span> <span class="n">in_y</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">out_x</span><span class="p">,</span> <span class="n">out_y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_manual_locid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds location IDs from text to location table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">locid_input_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_locid_input_set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">locid</span> <span class="ow">in</span> <span class="n">locid_input_set</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_loc_tbl_row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_locid_list</span><span class="p">(</span><span class="o">*</span><span class="n">locid</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">NoLocExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;No Location&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Enter at least one location.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">LocidTxtExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Enter valid UUID separated by commas.</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">u</span><span class="s1">&#39;For example:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">u</span><span class="s1">&#39;0001b8f3-65fb-4877-8808-ca67094e1cbb, &#39;</span>
                <span class="sa">u</span><span class="s1">&#39;0002bdc7-b232-4c5b-bd4d-3d4f21da24b6&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_locid_input_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location ID input set.</span>

<span class="sd">        :returns: A location ID input set.</span>
<span class="sd">        :rtype: ordered_set.OrderedSet</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">locid_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_locid_pte</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">locid_txt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoLocExc</span><span class="p">()</span>

        <span class="n">locid_txt</span> <span class="o">=</span> <span class="n">locid_txt</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="n">locid_input_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">locid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">locid</span> <span class="ow">in</span> <span class="n">locid_txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">locid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">locid_input_list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">locid</span><span class="p">)</span>
                <span class="n">locid_input_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">locid</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">LocidTxtExc</span><span class="p">()</span>

        <span class="n">locid_input_set</span> <span class="o">=</span> <span class="n">ordered_set</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">locid_input_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">locid_input_set</span>

    <span class="k">def</span> <span class="nf">_add_manual_coor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds coordinates from text to location table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">crs_desc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manual_crs_desc</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manual_opt</span>
            <span class="n">coor_input_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_coor_input_set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">coor</span> <span class="ow">in</span> <span class="n">coor_input_set</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_loc_tbl_row</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_coor_list</span><span class="p">(</span><span class="n">crs_desc</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="o">*</span><span class="n">coor</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">NoLocExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;No Location&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Enter at least one location.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">CoorTxtExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Enter location in this format separated by commas &#39;</span>
                <span class="sa">u</span><span class="s1">&#39;(verbatimLocality is optional):</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">u</span><span class="s1">&#39;&quot;&lt;X&gt; &lt;Y&gt; &lt;verbatimLocality&gt;&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">u</span><span class="s1">&#39;For example:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">u</span><span class="s1">&#39;601404.85 6644928.24 Hovinbk, &#39;</span>
                <span class="sa">u</span><span class="s1">&#39;580033.12 6633807.99 Drengsrudbk&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_coor_input_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a coordinates input set.</span>

<span class="sd">        :returns: A coordinates input set.</span>
<span class="sd">        :rtype: ordered_set.OrderedSet</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">coor_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_coor_pte</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">coor_txt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoLocExc</span><span class="p">()</span>

        <span class="n">coor_txt</span> <span class="o">=</span> <span class="n">coor_txt</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="n">coor_input_list</span> <span class="o">=</span> \
            <span class="p">[</span><span class="n">loc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">coor_txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coor_input_list</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">coor_input_list</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">coor_input_list</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">n</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">CoorTxtExc</span><span class="p">()</span>

        <span class="n">coor_input_set</span> <span class="o">=</span> <span class="n">ordered_set</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">coor_input_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">coor_input_set</span>

    <span class="k">def</span> <span class="nf">_add_manual_nvl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds `Norwegian VatnLnr` from text to location table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">nvl_input_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_nvl_input_set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">nvl</span> <span class="ow">in</span> <span class="n">nvl_input_set</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_loc_tbl_row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_nvl_list</span><span class="p">(</span><span class="o">*</span><span class="n">nvl</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">NoLocExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;No Location&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Enter at least one location.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NvlTxtExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Enter integers separated by commas.</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">u</span><span class="s1">&#39;For example:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="sa">u</span><span class="s1">&#39;3067, 5616, 5627&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_nvl_input_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a `Norwegian VatnLnr` input set.</span>

<span class="sd">        :returns: A `Norwegian VatnLnr` input set.</span>
<span class="sd">        :rtype: ordered_set.OrderedSet</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nvl_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_nvl_pte</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nvl_txt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NoLocExc</span><span class="p">()</span>

        <span class="n">nvl_txt</span> <span class="o">=</span> <span class="n">nvl_txt</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="n">nvl_input_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">nvl</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">nvl</span> <span class="ow">in</span> <span class="n">nvl_txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">nvl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nvl_input_list</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nvl_input_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nvl</span><span class="p">)]</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NvlTxtExc</span><span class="p">()</span>

        <span class="n">nvl_input_set</span> <span class="o">=</span> <span class="n">ordered_set</span><span class="o">.</span><span class="n">OrderedSet</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">nvl_input_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">nvl_input_set</span>

    <span class="k">def</span> <span class="nf">_preview_loc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Previews all locations in the location table.</span>
<span class="sd">        It adds two layer to map canvas:</span>

<span class="sd">            - layer of existing locations</span>
<span class="sd">            - layer of new locations.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">locid_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span>

            <span class="n">new_loc_feat_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                <span class="n">row_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_row_data</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

                <span class="n">loc_met</span> <span class="o">=</span> <span class="n">row_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># locationID</span>
                <span class="k">if</span> <span class="n">loc_met</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">locid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_locid_locid</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>
                <span class="c1"># coordinates</span>
                <span class="k">elif</span> <span class="n">loc_met</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">new_loc_feat</span><span class="p">,</span> <span class="n">locid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_new_loc_feat_locid_coor</span><span class="p">(</span>
                        <span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">new_loc_feat</span><span class="p">:</span>
                        <span class="n">new_loc_feat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_loc_feat</span><span class="p">)</span>
                <span class="c1"># nvl</span>
                <span class="k">elif</span> <span class="n">loc_met</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">locid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_locid_nvl</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">locid</span><span class="p">:</span>
                    <span class="n">locid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locid</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">locid_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">exg_loc_lyr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_loc_lyr</span><span class="p">(</span>
                    <span class="n">locid_list</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;preview_location-existing&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">exg_loc_lyr</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
                    <span class="n">QgsMapLayerRegistry</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">exg_loc_lyr</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_loc_feat_list</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">new_loc_lyr</span> <span class="o">=</span> <span class="n">QgsVectorLayer</span><span class="p">(</span>
                    <span class="sa">u</span><span class="s1">&#39;Point?crs=</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_utm33_crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()),</span>
                    <span class="sa">u</span><span class="s1">&#39;preview_location-new&#39;</span><span class="p">,</span>
                    <span class="sa">u</span><span class="s1">&#39;memory&#39;</span><span class="p">)</span>

                <span class="n">dp</span> <span class="o">=</span> <span class="n">new_loc_lyr</span><span class="o">.</span><span class="n">dataProvider</span><span class="p">()</span>
                <span class="n">dp</span><span class="o">.</span><span class="n">addFeatures</span><span class="p">(</span><span class="n">new_loc_feat_list</span><span class="p">)</span>
                <span class="n">new_loc_lyr</span><span class="o">.</span><span class="n">updateExtents</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">new_loc_lyr</span><span class="o">.</span><span class="n">isValid</span><span class="p">():</span>
                    <span class="n">QgsMapLayerRegistry</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">addMapLayer</span><span class="p">(</span><span class="n">new_loc_lyr</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">LocidMtyExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID of selected row is empty.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">LocidFmtExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID &quot;</span><span class="si">{}</span><span class="s1">&quot; is not UUID.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">locid</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">LocidNfExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID &quot;</span><span class="si">{}</span><span class="s1">&quot; was not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">locid</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">CoorMtyExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Both X and Y coordinates must be entered.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NvlMtyExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr of selected row is empty.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NvlNfExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr code &quot;</span><span class="si">{}</span><span class="s1">&quot; was not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">nvl</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_new_loc_feat_locid_coor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a new location feature or a location ID.</span>
<span class="sd">        It is used for &#39;coordinates&#39; method.</span>
<span class="sd">        Checks if both X and Y coordinates are entered.</span>
<span class="sd">        Based on option it returns a new location feature</span>
<span class="sd">        or returns location ID of the nearest location.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        :param row_data: Data in location table row.</span>
<span class="sd">        :type row_data: list</span>

<span class="sd">        :returns: A location ID of new location or the nearest location.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">crs_desc</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verb_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extr_coor_list</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CoorMtyExc</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="n">crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs_dict</span><span class="p">[</span><span class="n">crs_desc</span><span class="p">]</span>
        <span class="n">srid</span> <span class="o">=</span> <span class="n">crs</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">new_loc_feat</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">locid</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># new</span>
        <span class="k">if</span> <span class="n">opt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">out_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utm33_crs</span>
            <span class="n">out_x</span><span class="p">,</span> <span class="n">out_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trf_coord</span><span class="p">(</span><span class="n">crs</span><span class="p">,</span> <span class="n">out_crs</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">pnt_geom</span> <span class="o">=</span> <span class="n">QgsGeometry</span><span class="o">.</span><span class="n">fromPoint</span><span class="p">(</span><span class="n">QgsPoint</span><span class="p">(</span><span class="n">out_x</span><span class="p">,</span> <span class="n">out_y</span><span class="p">))</span>
            <span class="n">new_loc_feat</span> <span class="o">=</span> <span class="n">QgsFeature</span><span class="p">()</span>
            <span class="n">new_loc_feat</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">pnt_geom</span><span class="p">)</span>
        <span class="c1"># nearest</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">locid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_nrst_locid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">new_loc_feat</span><span class="p">,</span> <span class="n">locid</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_utm33_crs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return UTM33 CRS.</span>

<span class="sd">        :returns: UTM33 CRS.</span>
<span class="sd">        :rtype: QgsCoordinateReferenceSystem</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">utm33_crs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs_dict</span><span class="p">[</span><span class="sa">u</span><span class="s1">&#39;UTM33&#39;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">utm33_crs</span>

    <span class="k">def</span> <span class="nf">_fetch_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches a schema based on what tab is active.</span>
<span class="sd">        If the main tab is active it fetches data from `NOFA` schema,</span>
<span class="sd">        otherwise it fetches data from `plugin` schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_tabwdg</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_nofa_schema</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_plugin_schema</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_fetch_plugin_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches data from the `plugin` schema and populates tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pop_usr_cb</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_hist_tbls</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hist_tabwdg</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pop_usr_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the user combo box.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">usr_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_usr_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">)</span>
        <span class="n">usr_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_str</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">usr_cb</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usr_cb</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="n">usr_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">usr_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span>
            <span class="n">usr_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">usr_str</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">_fill_hist_tbls</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fills all history tables.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">hist_fltrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hist_fltrs</span>

        <span class="k">for</span> <span class="n">tbl</span><span class="p">,</span> <span class="n">fnc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist_tbls_fnc_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">tbl_list</span><span class="p">,</span> <span class="n">tbl_hdrs</span> <span class="o">=</span> <span class="n">fnc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="o">*</span><span class="n">hist_fltrs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_create_tbl_hist_tab</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="n">tbl_list</span><span class="p">,</span> <span class="n">tbl_hdrs</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_hist_fltrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns history filters.</span>
<span class="sd">        It is used to filter entries in history tab.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A tuple containing:</span>
<span class="sd">         |    - *str* -- user</span>
<span class="sd">         |    - *datetime.date* -- insert start date</span>
<span class="sd">         |    - *datetime.date* -- insert end date</span>
<span class="sd">         |    - *datetime.date* -- update start date</span>
<span class="sd">         |    - *datetime.date* -- update end date</span>
<span class="sd">        :rtype: tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">usr_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">usr_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">usr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">usr_txt</span><span class="p">)</span>

        <span class="n">ins_dt_strt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtstrt_de</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">toPyDate</span><span class="p">()</span>
        <span class="n">ins_dt_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist_ins_dtend_de</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">toPyDate</span><span class="p">()</span>
        <span class="n">upd_dt_strt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtstrt_de</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">toPyDate</span><span class="p">()</span>
        <span class="n">upd_dt_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hist_upd_dtend_de</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">toPyDate</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">usr</span><span class="p">,</span> <span class="n">ins_dt_strt</span><span class="p">,</span> <span class="n">ins_dt_end</span><span class="p">,</span> <span class="n">upd_dt_strt</span><span class="p">,</span> <span class="n">upd_dt_end</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_open_dtst_dlg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a dialog for adding a new dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dtst_dlg</span> <span class="o">=</span> <span class="n">dtst_dlg</span><span class="o">.</span><span class="n">DtstDlg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtst_dlg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_open_prj_dlg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a dialog for adding a new project.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">prj_dlg</span> <span class="o">=</span> <span class="n">prj_dlg</span><span class="o">.</span><span class="n">PrjDlg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prj_dlg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_open_ref_dlg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Opens a dialog for adding a new reference.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_dlg</span> <span class="o">=</span> <span class="n">ref_dlg</span><span class="o">.</span><span class="n">RefDlg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_dlg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_upd_txncvg_tw_chldn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates children in the taxonomic coverage tree widget</span>
<span class="sd">        based on the state of its parent.</span>

<span class="sd">        :param par: A changed item.</span>
<span class="sd">        :type par: QTableWidgetItem</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">chck_state</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
            <span class="n">chld</span> <span class="o">=</span> <span class="n">par</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">chld</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">chck_state</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_upd_txncvg_tw_chldn</span><span class="p">(</span><span class="n">chld</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rst</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets all widgets in the main tab.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_loc_tbl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_loc_wdgs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_event_wdgs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_mtdt_wdgs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_occ_tbl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_txncvg_tw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_rst_loc_tbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets location table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_del_btn</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_rstrow_btn</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_rst_loc_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets location widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_cb_by_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loc_cb_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_cb_by_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loc_edit_met_cb_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_cb_by_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loc_manual_met_cb_dict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wb_le</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lake_name_statlbl</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;Search for locations.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rst_event_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets all event widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_input_wdgs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_cb_by_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_event_cb_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rst_mtdt_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets all metadata widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sel_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">upd_dtst</span><span class="p">(</span><span class="n">sel_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upd_prj</span><span class="p">(</span><span class="n">sel_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upd_ref</span><span class="p">(</span><span class="n">sel_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rst_occ_tbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets occurrence table.</span>
<span class="sd">        Also resets occurrence widgets because it is connected to the table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">occ_del_btn</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">occ_rstrow_btn</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_rst_txncvg_tw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets taxonomic coverage tree widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">txncvg_root_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">txncvg_tw</span><span class="o">.</span><span class="n">invisibleRootItem</span><span class="p">()</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">txncvg_root_item</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">:</span>
            <span class="n">txncvg_root_item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">)</span>

        <span class="n">txncvg_root_item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txncvg_tw</span><span class="o">.</span><span class="n">expandToDepth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ins</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts the data into the database.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chck_mand_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mtdt_mand_wdgs</span><span class="p">,</span> <span class="n">MtdtNotFldExc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_chck_occ_tbl</span><span class="p">()</span>

            <span class="n">locid_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_loc_list</span><span class="p">()</span>

            <span class="n">event_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wdg_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">event_input_wdgs</span><span class="p">)</span>

            <span class="n">dtst_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dtst_id</span><span class="p">()</span>
            <span class="n">prj_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_prj_id</span><span class="p">()</span>
            <span class="n">ref_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ref_id</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">loc_id</span> <span class="ow">in</span> <span class="n">locid_list</span><span class="p">:</span>
                <span class="n">event_id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>

                <span class="n">db</span><span class="o">.</span><span class="n">ins_event</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span>
                    <span class="n">loc_id</span><span class="p">,</span> <span class="n">event_id</span><span class="p">,</span> <span class="n">event_list</span><span class="p">,</span> <span class="n">dtst_id</span><span class="p">,</span> <span class="n">prj_id</span><span class="p">,</span> <span class="n">ref_id</span><span class="p">)</span>

                <span class="n">db</span><span class="o">.</span><span class="n">ins_event_log</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span>
                    <span class="n">loc_id</span><span class="p">,</span> <span class="n">event_id</span><span class="p">,</span> <span class="n">dtst_id</span><span class="p">,</span> <span class="n">prj_id</span><span class="p">,</span> <span class="n">ref_id</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">usr_str</span><span class="p">])</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_ins_txncvg</span><span class="p">(</span><span class="n">event_id</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
                    <span class="n">occ_id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>

                    <span class="n">occ_row_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_occ_row_list</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

                    <span class="n">txn_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_txn_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">occ_row_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                    <span class="n">ectp</span> <span class="o">=</span> <span class="n">occ_row_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ectp_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_ectp_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">ectp</span><span class="p">)</span>

                    <span class="n">db</span><span class="o">.</span><span class="n">ins_occ</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span>
                        <span class="n">occ_id</span><span class="p">,</span> <span class="n">txn_id</span><span class="p">,</span> <span class="n">ectp_id</span><span class="p">,</span> <span class="n">occ_row_list</span><span class="p">,</span> <span class="n">event_id</span><span class="p">)</span>

                    <span class="n">db</span><span class="o">.</span><span class="n">ins_occ_log</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span>
                        <span class="n">occ_id</span><span class="p">,</span> <span class="n">event_id</span><span class="p">,</span> <span class="n">dtst_id</span><span class="p">,</span> <span class="n">prj_id</span><span class="p">,</span> <span class="n">ref_id</span><span class="p">,</span> <span class="n">loc_id</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">usr_str</span><span class="p">])</span>

            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Saved&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Data correctly saved.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">MtdtNotFldExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">wdg</span><span class="o">.</span><span class="n">parent</span><span class="p">())</span>
            <span class="n">e</span><span class="o">.</span><span class="n">wdg</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Mandatory Metadata Fields&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Fill/select all mandatory metadata fields.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">OccNotFldExc</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Taxon&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;Select taxon.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">LocidMtyExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID of selected row is empty.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">LocidFmtExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID &quot;</span><span class="si">{}</span><span class="s1">&quot; is not UUID.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">locid</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">LocidNfExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;locationID &quot;</span><span class="si">{}</span><span class="s1">&quot; was not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">locid</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">CoorMtyExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;coordinates&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Both X and Y coordinates must be entered.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NvlMtyExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr of selected row is empty.&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">NvlNfExc</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_wdg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr&#39;</span><span class="p">,</span>
                <span class="sa">u</span><span class="s1">&#39;Norwegian VatLnr code &quot;</span><span class="si">{}</span><span class="s1">&quot; was not found.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">nvl</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_chck_occ_tbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if all rows in the occurrence are filled.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">occ_row_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_occ_row_list</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">occ_row_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">OccNotFldExc</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_loc_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location ID list.</span>

<span class="sd">        :returns: A location ID list.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">locid_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">row_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_row_data</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

            <span class="n">loc_met</span> <span class="o">=</span> <span class="n">row_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># locationID</span>
            <span class="k">if</span> <span class="n">loc_met</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">locid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_locid_locid</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>
            <span class="c1"># coordinates</span>
            <span class="k">elif</span> <span class="n">loc_met</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">locid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_locid_coor</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>
            <span class="c1"># nvl</span>
            <span class="k">elif</span> <span class="n">loc_met</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">locid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_locid_nvl</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">)</span>

            <span class="n">locid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">locid_list</span>

    <span class="k">def</span> <span class="nf">_get_locid_locid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location ID. It is used for &#39;locationID&#39; method.</span>
<span class="sd">        Checks if location ID is empty, if it a valid *UUID*</span>
<span class="sd">        and if it exists in the database.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        :param row_data: Data in location table row.</span>
<span class="sd">        :type row_data: list</span>

<span class="sd">        :returns: A location ID.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">locid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extr_locid_list</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">locid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LocidMtyExc</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">locid</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LocidFmtExc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">locid</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">db</span><span class="o">.</span><span class="n">chck_locid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">locid</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">LocidNfExc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">locid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">locid</span>

    <span class="k">def</span> <span class="nf">_get_locid_coor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location ID. It is used for &#39;coordinates&#39; method.</span>
<span class="sd">        Checks if both X and Y coordinates are entered.</span>
<span class="sd">        Based on option it inserts new location or returns location ID</span>
<span class="sd">        of the nearest location.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        :param row_data: Data in location table row.</span>
<span class="sd">        :type row_data: list</span>

<span class="sd">        :returns: A location ID of new location or the nearest location.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">crs_desc</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">verb_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extr_coor_list</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CoorMtyExc</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="n">srid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs_dict</span><span class="p">[</span><span class="n">crs_desc</span><span class="p">]</span><span class="o">.</span><span class="n">authid</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># new</span>
        <span class="k">if</span> <span class="n">opt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">locid</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>

            <span class="n">mpt_str</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_mpt_str</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">utm33_geom</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_utm33_geom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">mpt_str</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">ins_new_loc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">locid</span><span class="p">,</span> <span class="n">utm33_geom</span><span class="p">,</span> <span class="n">verb_loc</span><span class="p">)</span>
            <span class="n">db</span><span class="o">.</span><span class="n">ins_loc_log</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span>
                <span class="n">locid</span><span class="p">,</span>
                <span class="n">verb_loc</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con_info</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">usr_str</span><span class="p">])</span>
        <span class="c1"># nearest</span>
        <span class="k">elif</span> <span class="n">opt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">locid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_nrst_locid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">locid</span>

    <span class="k">def</span> <span class="nf">_get_nrst_locid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">srid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location ID of the nearest location.</span>

<span class="sd">        :param x: X coordinate.</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: Y coordinate.</span>
<span class="sd">        :type y: float</span>
<span class="sd">        :param srid: SRID.</span>
<span class="sd">        :type srid: int</span>

<span class="sd">        :returns: A location ID of the nearest location.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pt_str</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_pt_str</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">utm33_geom</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_utm33_geom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">pt_str</span><span class="p">,</span> <span class="n">srid</span><span class="p">)</span>
        <span class="n">locid</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_nrst_locid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">utm33_geom</span><span class="p">)</span>

        <span class="n">locid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">locid</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">locid</span>

    <span class="k">def</span> <span class="nf">_get_locid_nvl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">row_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location ID. It is used for &#39;Norwegian VatLnr&#39; method.</span>
<span class="sd">        Checks if Norwegian VatLnr is empty.</span>
<span class="sd">        It searches for location ID with the given Norwegian VatLnr.</span>

<span class="sd">        :param m: A location table row.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        :param row_data: Data in location table row.</span>
<span class="sd">        :type row_data: list</span>

<span class="sd">        :returns: A location ID with the given Norwegian VatLnr.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">nvl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_extr_nvl_list</span><span class="p">(</span><span class="n">row_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NvlMtyExc</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">locid</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_locid_from_nvl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">nvl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NvlNfExc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nvl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">locid</span>

<div class="viewcode-block" id="InsMw.get_wdg_list"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.get_wdg_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_wdg_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wdgs</span><span class="p">,</span> <span class="n">pydate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">forbi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the data from the given list of widgets.</span>

<span class="sd">        :param wdgs: A list of widgets whose data should be returned.</span>
<span class="sd">        :type wdgs: list</span>
<span class="sd">        :param pydate: True to convert *QDate* to *datetime.date*,</span>
<span class="sd">            False otherwise.</span>
<span class="sd">        :type pydate: bool</span>
<span class="sd">        :param forbi: True to allow forbidden text, False otherwise.</span>
<span class="sd">        :type forbi: bool</span>

<span class="sd">        :returns: A list of data from event input widgets.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">wdg_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">wdg</span> <span class="ow">in</span> <span class="n">wdgs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">wdg</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

                <span class="n">wdg_vald</span> <span class="o">=</span> <span class="n">wdg</span><span class="o">.</span><span class="n">validator</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">vald</span><span class="p">:</span>
                    <span class="n">wdg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">forbi</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg_vald</span><span class="p">,</span> <span class="p">(</span><span class="n">QIntValidator</span><span class="p">,</span> <span class="n">vald</span><span class="o">.</span><span class="n">LenIntVald</span><span class="p">)):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">wdg_data</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">wdg_data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg_vald</span><span class="p">,</span> <span class="n">QDoubleValidator</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">wdg_data</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">wdg_data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wdg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">forbi</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">wdg</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
                <span class="n">wdg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">forbi</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">wdg</span><span class="o">.</span><span class="n">findChild</span><span class="p">(</span><span class="n">QLineEdit</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">:</span>
                    <span class="n">wdg_data</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">wdg_data</span> <span class="o">=</span> <span class="n">wdg</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">pydate</span><span class="p">:</span>
                        <span class="n">wdg_data</span> <span class="o">=</span> <span class="n">wdg_data</span><span class="o">.</span><span class="n">toPyDate</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QPlainTextEdit</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">wdg</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
                <span class="n">wdg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span> <span class="n">forbi</span><span class="p">)</span>

            <span class="n">wdg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">wdg_list</span></div>

    <span class="k">def</span> <span class="nf">_rst_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wdgs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets the given widgets.</span>

<span class="sd">            - *QLineEdit* -- clear</span>
<span class="sd">            - *QPlainTextEdit* -- clear</span>
<span class="sd">            - *QComboBox* -- set current index to 0</span>
<span class="sd">            - *QDateEdit* -- set date to minimum</span>

<span class="sd">        :param wdgs: Widgets to be cleared.</span>
<span class="sd">        :type wdgs: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wdg</span> <span class="ow">in</span> <span class="n">wdgs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QPlainTextEdit</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">setDate</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">minimumDate</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_get_occ_row_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">forbi</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an occurrence row list.</span>

<span class="sd">        :param m: A row number.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        :param forbi: True to allow forbidden text, False otherwise.</span>
<span class="sd">        :type forbi: bool</span>

<span class="sd">        :returns: A list of data in the given row in the occurrence table.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">occ_row_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># OS.NINA</span>
        <span class="c1"># depends on the order in the table</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="n">wdg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)):</span>
                <span class="n">wdg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">,</span> <span class="n">forbi</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">,</span> <span class="n">QDate</span><span class="p">):</span>
                <span class="n">wdg_data</span> <span class="o">=</span> <span class="n">wdg_data</span><span class="o">.</span><span class="n">toPyDate</span><span class="p">()</span>

            <span class="n">occ_row_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">occ_row_list</span>

    <span class="k">def</span> <span class="nf">_ins_txncvg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inserts all checked taxons into the database.</span>

<span class="sd">        :param event_id: An event ID.</span>
<span class="sd">        :type event_id: uuid.UUID</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">txn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ckd_txns</span><span class="p">:</span>
            <span class="n">txn_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_txn_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">txn</span><span class="p">)</span>

            <span class="n">db</span><span class="o">.</span><span class="n">ins_txncvg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">txn_id</span><span class="p">,</span> <span class="n">event_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_ckd_txns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns all checked taxons from the taxon coverage tree widget.</span>

<span class="sd">        :returns: A list of all checked taxons.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">txn_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">all_item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">txncvg_tw</span><span class="o">.</span><span class="n">invisibleRootItem</span><span class="p">()</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">all_item</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
            <span class="n">fam_item</span> <span class="o">=</span> <span class="n">all_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fam_item</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
                <span class="n">txn_item</span> <span class="o">=</span> <span class="n">fam_item</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">txn_item</span><span class="o">.</span><span class="n">checkState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Checked</span><span class="p">:</span>
                    <span class="n">txn_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txn_item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">txn_list</span>

<div class="viewcode-block" id="InsMw.upd_dtst"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.upd_dtst">[docs]</a>    <span class="k">def</span> <span class="nf">upd_dtst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtst_str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a dataset according to the last selected.</span>

<span class="sd">        :param dtst_str: A dataset string `&lt;ID&gt; - &lt;name&gt;`.</span>
<span class="sd">        :type dtst_str: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upd_mtdt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtst_cb</span><span class="p">,</span> <span class="n">dtst_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="InsMw.upd_prj"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.upd_prj">[docs]</a>    <span class="k">def</span> <span class="nf">upd_prj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prj_str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a project according to the last selected.</span>

<span class="sd">        :param prj_str: A project string `&lt;name&gt; - &lt;organisation&gt;`.</span>
<span class="sd">        :type prj_str: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upd_mtdt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prj_cb</span><span class="p">,</span> <span class="n">prj_str</span><span class="p">)</span></div>

<div class="viewcode-block" id="InsMw.upd_ref"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.upd_ref">[docs]</a>    <span class="k">def</span> <span class="nf">upd_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref_str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a reference according to the last selected.</span>

<span class="sd">        :param ref_str: A reference string `&lt;author&gt;: &lt;title&gt; (&lt;year&gt;) @&lt;ID&gt;`.</span>
<span class="sd">        :type ref_str: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upd_mtdt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_cb</span><span class="p">,</span> <span class="n">ref_str</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_upd_mtdt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">cb_str</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a metadata according to the last selected.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">cb_str</span><span class="p">:</span>
            <span class="n">cb_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">objectName</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">cb_str</span><span class="p">:</span>
            <span class="n">cb_idx</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">cb_str</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">cb_idx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cb_str</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upd_mtdt_lw</span><span class="p">(</span><span class="n">cb_str</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_upd_mtdt_lw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb_str</span><span class="p">,</span> <span class="n">cb</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates a metadata list widget.</span>

<span class="sd">        :param cb_str: A combob box string.</span>
<span class="sd">        :type cb_str: str</span>
<span class="sd">        :param cb: A combo box.</span>
<span class="sd">        :type cb: QComboBox</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cb_str</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">cb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
            <span class="n">cb_str</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">indexOf</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">parentWidget</span><span class="p">())</span>
        <span class="n">mdtd_base_txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">itemText</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dash_split_str</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">lw</span><span class="p">,</span> <span class="n">id_met</span><span class="p">,</span> <span class="n">info_fnc</span><span class="p">,</span> <span class="n">mtdt_str_fnc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mtdt_lw_cb_dict</span><span class="p">[</span><span class="n">cb</span><span class="p">]</span>

        <span class="n">lw</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">cb_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">forbi_str_list</span><span class="p">:</span>
            <span class="n">mtdt_txt</span> <span class="o">=</span> <span class="n">cb_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">items</span><span class="p">,</span> <span class="n">hdrs</span> <span class="o">=</span> <span class="n">info_fnc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">id_met</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_pop_lw</span><span class="p">(</span><span class="n">lw</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">hdrs</span><span class="p">)</span>

            <span class="n">mtdt_txt</span> <span class="o">=</span> <span class="n">mtdt_str_fnc</span><span class="p">(</span><span class="n">cb_str</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_mtdt_item_txt</span><span class="p">(</span>
            <span class="n">idx</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="si">{}{}{}</span><span class="s1">&#39;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mdtd_base_txt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dash_split_str</span><span class="p">,</span> <span class="n">mtdt_txt</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">objectName</span><span class="p">(),</span> <span class="n">cb_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_mtdt_item_txt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item_index</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets metadata item text.</span>

<span class="sd">        :param item_index: An item index.</span>
<span class="sd">        :type item_index: int</span>
<span class="sd">        :param text: A text.</span>
<span class="sd">        :type text: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">main_tb</span><span class="o">.</span><span class="n">setItemText</span><span class="p">(</span><span class="n">item_index</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mtdt_lw_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a metadata list widget combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A metadata combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [</span>
<span class="sd">         |        &lt;list widget&gt;,</span>
<span class="sd">         |        &lt;method that returns ID&gt;,</span>
<span class="sd">         |        &lt;function that returns information&gt;,</span>
<span class="sd">         |        &lt;function that returns metadata string&gt;]</span>
<span class="sd">        :rtype: dict.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mtdt_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtst_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dtst_lw</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_dtst_id</span><span class="p">,</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_dtst_info</span><span class="p">,</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_dtst_mtdt_str</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">prj_lw</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_prj_id</span><span class="p">,</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_prj_info</span><span class="p">,</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_prj_mtdt_str</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ref_lw</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_ref_id</span><span class="p">,</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_ref_info</span><span class="p">,</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_ref_mtdt_str</span><span class="p">]}</span>

        <span class="k">return</span> <span class="n">mtdt_cb_dict</span>

    <span class="k">def</span> <span class="nf">_pop_lw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lw</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">hdrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the given list widget.</span>
<span class="sd">        Adds all items with their corresponding headers `&lt;header&gt;: &lt;item&gt;`.</span>

<span class="sd">        :param lw: A list widget.</span>
<span class="sd">        :type lw: QListWidget</span>
<span class="sd">        :param items: Items to be added.</span>
<span class="sd">        :type items: list</span>
<span class="sd">        :param hdrs: Headers to be added.</span>
<span class="sd">        :type hdrs: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">hdr</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hdrs</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
            <span class="n">lw_item</span> <span class="o">=</span> <span class="n">QListWidgetItem</span><span class="p">(</span>
                <span class="sa">u</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hdr</span><span class="p">,</span> <span class="n">unicode</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">if</span> <span class="n">item</span> <span class="k">else</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
            <span class="n">lw</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">lw_item</span><span class="p">)</span>

<div class="viewcode-block" id="InsMw.prep"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.prep">[docs]</a>    <span class="k">def</span> <span class="nf">prep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares the whole plugin to be shown.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_nofa_schema</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_loc_tbl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_loc_wdgs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_event_wdgs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_occ_tbl</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_txncvg_tw</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_fetch_nofa_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches data from the `NOFA` schema and populates widgets.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nofa_cb_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nofa_cb_dict</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_cb</span><span class="p">(</span><span class="n">nofa_cb_dict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">upd_dtst</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upd_prj</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upd_ref</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pop_txncvg_tw</span><span class="p">()</span>

<div class="viewcode-block" id="InsMw.pop_cb"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.pop_cb">[docs]</a>    <span class="k">def</span> <span class="nf">pop_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates combo boxes.</span>

<span class="sd">        :param cb_dict:</span>
<span class="sd">         | A combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :type cb_dict: dict.</span>
<span class="sd">        :param cb: Who knows.</span>
<span class="sd">        :type cb: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">cb</span><span class="p">,</span> <span class="n">cb_list</span> <span class="ow">in</span> <span class="n">cb_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fnc</span> <span class="o">=</span> <span class="n">cb_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">cb_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">def_val</span> <span class="o">=</span> <span class="n">cb_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">item_list</span> <span class="o">=</span> <span class="n">fnc</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">def_val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
                <span class="n">item_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">def_val</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_add_cb_items</span><span class="p">(</span><span class="n">cb</span><span class="p">,</span> <span class="n">item_list</span><span class="p">)</span>

            <span class="n">cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">item_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">def_val</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_pop_cnty_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the county combo box according to the currently selected</span>
<span class="sd">        country.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_cb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_cnty_cb_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pop_muni_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the municipality combo box according to the currently</span>
<span class="sd">        selected country and county.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_cb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_muni_cb_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pop_ectp_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the ecotype combo box according to the currently selected</span>
<span class="sd">        taxon.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_cb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ectp_cb_dict</span><span class="p">)</span>

<div class="viewcode-block" id="InsMw.pop_dtst_cb"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.pop_dtst_cb">[docs]</a>    <span class="k">def</span> <span class="nf">pop_dtst_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the dataset combo box.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_cb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtst_cb_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="InsMw.pop_prj_cb"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.pop_prj_cb">[docs]</a>    <span class="k">def</span> <span class="nf">pop_prj_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the project combo box.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_cb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_prj_cb_dict</span><span class="p">)</span></div>

<div class="viewcode-block" id="InsMw.pop_ref_cb"><a class="viewcode-back" href="../../../api.html#nofa.gui.ins_mw.InsMw.pop_ref_cb">[docs]</a>    <span class="k">def</span> <span class="nf">pop_ref_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the reference combo box.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pop_cb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ref_cb_dict</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_add_cb_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb</span><span class="p">,</span> <span class="n">item_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds items from the item list to the combo box.</span>

<span class="sd">        :param cb: A combob box.</span>
<span class="sd">        :type cb: QComboBox</span>
<span class="sd">        :param item_list: An item list.</span>
<span class="sd">        :type item_list: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cb</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">item_list</span><span class="p">):</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="c1"># if item in self.forbi_str_list:</span>
            <span class="c1">#     clr = self.red_clr</span>
            <span class="c1">#     cb.setItemData(i, QBrush(clr), Qt.BackgroundRole)</span>

    <span class="k">def</span> <span class="nf">_rst_cb_by_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets combo boxes by the given combo box dictionary.</span>

<span class="sd">        :param cb_dict:</span>
<span class="sd">         | A combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :type cb_dict: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">cb</span><span class="p">,</span> <span class="n">cb_list</span> <span class="ow">in</span> <span class="n">cb_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">def_val</span> <span class="o">=</span> <span class="n">cb_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">def_val</span><span class="p">))</span>

            <span class="c1"># ensure that signal is emitted</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">cb</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_nofa_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a `NOFA` combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A `NOFA` combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nofa_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oqt_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_oqt_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">poptrend_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_poptrend_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spwnc_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_spwnc_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spwnl_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_spwnl_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">]}</span>

        <span class="n">nofa_cb_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mrgd_dict</span><span class="p">(</span>
            <span class="n">nofa_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loc_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loc_edit_met_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loc_manual_met_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_event_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ectp_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mtdt_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_occ_mand_cb_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">nofa_cb_dict</span>

    <span class="k">def</span> <span class="nf">_get_mrgd_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">dicts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a merged dictionary of all given dictionaries.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mrgd_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="nb">dict</span> <span class="ow">in</span> <span class="n">dicts</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">mrgd_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

        <span class="k">return</span> <span class="n">mrgd_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_loc_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a combo box dictionary for all location combo boxes.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A combo box dictionary for all location combo boxes:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">loc_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cntry_code_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_cntry_code_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_str</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_crs_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_srs_desc_list</span><span class="p">,</span>
                <span class="p">[],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_opt_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_opt_list</span><span class="p">,</span>
                <span class="p">[],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_coor_crs_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_srs_desc_list</span><span class="p">,</span>
                <span class="p">[],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_coor_opt_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_opt_list</span><span class="p">,</span>
                <span class="p">[],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">opt_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>

        <span class="n">loc_cb_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mrgd_dict</span><span class="p">(</span>
            <span class="n">loc_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cnty_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_muni_cb_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loc_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_cnty_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a county combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A county combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cnty_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cnty_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_cnty_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cntry_code</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_str</span><span class="p">]}</span>

        <span class="k">return</span> <span class="n">cnty_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_muni_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a municipality combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A municipality combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">muni_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">muni_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_muni_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cntry_code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cnty</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">all_str</span><span class="p">]}</span>

        <span class="k">return</span> <span class="n">muni_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_event_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a combo box dictionary for all event combo boxes.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A combo box dictionary for all event combo boxes:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">event_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smpp_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_smpp_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smpsu_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_smpsu_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relia_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_reliab_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">]}</span>

        <span class="k">return</span> <span class="n">event_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_ectp_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an ecotype combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | An ecotype combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ectp_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ectp_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_ectp_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_txn</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mty_str</span><span class="p">]}</span>

        <span class="k">return</span> <span class="n">ectp_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_mtdt_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a metadata combo box dictionary.</span>

<span class="sd">        :returns: A metadata combo box dictionary.</span>
<span class="sd">         | A metadata combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mtdt_cb_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mrgd_dict</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dtst_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prj_cb_dict</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ref_cb_dict</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mtdt_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_dtst_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dataset combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A dataset combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dtst_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dtst_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_dtst_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span><span class="p">]}</span>

        <span class="k">return</span> <span class="n">dtst_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_prj_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a project combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A project combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">prj_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prj_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_prj_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span><span class="p">]}</span>

        <span class="k">return</span> <span class="n">prj_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_ref_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a reference combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A reference combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ref_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_ref_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span><span class="p">]}</span>

        <span class="k">return</span> <span class="n">ref_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_loc_edit_met_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location edit method combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A location edit method combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">loc_edit_met_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_loc_met_list</span><span class="p">,</span>
                <span class="p">[],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]]}</span>

        <span class="k">return</span> <span class="n">loc_edit_met_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_loc_manual_met_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a location manual method combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | A location manual method combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">loc_manual_met_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_met_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_get_loc_met_list</span><span class="p">,</span>
                <span class="p">[],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span><span class="p">[</span><span class="mi">2</span><span class="p">]]}</span>

        <span class="k">return</span> <span class="n">loc_manual_met_cb_dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_occ_mand_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an occurrence mandatory combo box dictionary.</span>

<span class="sd">        :returns:</span>
<span class="sd">         | An occurrence mandatory combo box dictionary:</span>
<span class="sd">         |    - key - &lt;combo box name&gt;</span>
<span class="sd">         |    - value - [&lt;fill method&gt;, [&lt;arguments&gt;], &lt;default value&gt;]</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">occ_mand_cb_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">txn_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_txn_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel_str</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">occstat_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_occstat_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_col_def_val</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span>
                    <span class="s1">&#39;nofa&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;occurrence&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;occurrenceStatus&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">estm_cb</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_estbms_list</span><span class="p">,</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">],</span>
                <span class="n">db</span><span class="o">.</span><span class="n">get_col_def_val</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span>
                    <span class="s1">&#39;nofa&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;occurrence&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;establishmentMeans&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]}</span>

        <span class="k">return</span> <span class="n">occ_mand_cb_dict</span>

    <span class="k">def</span> <span class="nf">_pop_txncvg_tw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Populates the taxon coverage tree widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txncvg_tw</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="n">fam_dict</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_fam_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">)</span>

        <span class="n">root_item</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">txncvg_tw</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;All&quot;</span><span class="p">])</span>
        <span class="n">root_item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
        <span class="n">root_item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">fam</span> <span class="ow">in</span> <span class="n">fam_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">family_item</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">root_item</span><span class="p">,</span> <span class="p">[</span><span class="n">fam</span><span class="p">])</span>
            <span class="n">family_item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="n">family_item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">txn</span> <span class="ow">in</span> <span class="n">fam_dict</span><span class="p">[</span><span class="n">fam</span><span class="p">]:</span>
                <span class="n">txn_item</span> <span class="o">=</span> <span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">family_item</span><span class="p">,</span> <span class="p">[</span><span class="n">txn</span><span class="p">])</span>
                <span class="n">txn_item</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
                <span class="n">txn_item</span><span class="o">.</span><span class="n">setFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsUserCheckable</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">ItemIsEnabled</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">txncvg_tw</span><span class="o">.</span><span class="n">sortByColumn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">AscendingOrder</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">txncvg_tw</span><span class="o">.</span><span class="n">expandToDepth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_dtst_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dataset ID from the dataset combo box.</span>

<span class="sd">        :returns: A dataset ID.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dtst_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtst_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="nb">id</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">split_dtst_str</span><span class="p">(</span><span class="n">dtst_str</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">id</span>

    <span class="k">def</span> <span class="nf">_get_prj_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a project ID based on name and organization.</span>

<span class="sd">        :returns: A project ID.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">prj_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prj_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="n">prj_name</span><span class="p">,</span> <span class="n">prj_org</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">split_prj_str</span><span class="p">(</span><span class="n">prj_str</span><span class="p">)</span>

        <span class="n">prj_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_prj_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">con</span><span class="p">,</span> <span class="n">prj_name</span><span class="p">,</span> <span class="n">prj_org</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">prj_id</span>

    <span class="k">def</span> <span class="nf">_get_ref_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a reference ID from the reference combo box.</span>

<span class="sd">        :returns: A reference ID.</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ref_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_cb</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_val_txt</span><span class="p">(</span><span class="n">ref_str</span><span class="p">):</span>
            <span class="n">au</span><span class="p">,</span> <span class="n">ttl</span><span class="p">,</span> <span class="n">yr</span><span class="p">,</span> <span class="nb">id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">split_ref_str</span><span class="p">(</span><span class="n">ref_str</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="nb">id</span>

    <span class="k">def</span> <span class="nf">_get_srs_desc_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of SRS descriptions.</span>

<span class="sd">        :returns: A list of SRS descriptions.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">srs_desc_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crs_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">srs_desc_list</span>

    <span class="k">def</span> <span class="nf">_get_loc_met_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of methods.</span>

<span class="sd">        :returns: A list of methods.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">met_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_met_list</span>

        <span class="k">return</span> <span class="n">met_list</span>

    <span class="k">def</span> <span class="nf">_get_opt_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of options.</span>

<span class="sd">        :returns: A list of options.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">opt_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_list</span>

        <span class="k">return</span> <span class="n">opt_list</span>

    <span class="k">def</span> <span class="nf">_create_tbl_main_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tbl</span><span class="p">,</span> <span class="n">tbl_hdrs</span><span class="p">,</span> <span class="n">tbl_wdgs</span><span class="p">,</span> <span class="n">met</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a table with one row.</span>
<span class="sd">        This method is used for creating tables in the main tab.</span>

<span class="sd">        :param tbl: A table.</span>
<span class="sd">        :type tbl: QTableWidget</span>
<span class="sd">        :param tbl_hdrs: Table headers.</span>
<span class="sd">        :type tbl_hdrs: list</span>
<span class="sd">        :param tbl_wdgs: Table widgets.</span>
<span class="sd">        :type tbl_wdgs: list</span>
<span class="sd">        :param met: A method for updating table.</span>
<span class="sd">        :type met: function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">itemChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">)</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tbl_hdrs</span><span class="p">))</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setSelectionBehavior</span><span class="p">(</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">SelectRows</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">SingleSelection</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">tbl_hdrs</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">tbl_hdr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tbl_hdrs</span><span class="p">):</span>
            <span class="n">tbl_item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
            <span class="n">tbl_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">tbl_item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_con_wdgs_sgnls_to_met</span><span class="p">(</span><span class="n">tbl_wdgs</span><span class="p">,</span> <span class="n">met</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_con_wdgs_sgnls_to_met</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wdgs</span><span class="p">,</span> <span class="n">met</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connects signals of the given widgets to the given method.</span>

<span class="sd">            - *QLineEdit* - textChanged</span>
<span class="sd">            - *QComboBox* - currentIndexChanged</span>
<span class="sd">            - *QDateEdit* - dateChanged</span>

<span class="sd">        :param wdgs: Widgets.</span>
<span class="sd">        :type wdgs: list</span>
<span class="sd">        :param met: A method.</span>
<span class="sd">        :type met: function</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wdg</span> <span class="ow">in</span> <span class="n">wdgs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">met</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">met</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">dateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">met</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_emit_wdgs_sgnls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tbl_wdgs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emits signals of the given widgets.</span>

<span class="sd">            - *QLineEdit* - textChanged</span>
<span class="sd">            - *QComboBox* - currentIndexChanged</span>
<span class="sd">            - *QDateEdit* - dateChanged</span>

<span class="sd">        :param tbl_wdgs: Widgets.</span>
<span class="sd">        :type tbl_wdgs: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">wdg</span> <span class="ow">in</span> <span class="n">tbl_wdgs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">):</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">dateChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_upd_loc_tbl_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adjusts the current location table row according to the current</span>
<span class="sd">        location method.</span>
<span class="sd">        Also sets index of location method stacked widget.</span>

<span class="sd">        :param idx: A current index of location edit method combo box.</span>
<span class="sd">        :type idx: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_swdg</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>

        <span class="c1"># skip first column</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">cur_loc_edit_tbl_wdgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cur_loc_edit_tbl_wdgs</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_wdgs</span><span class="p">(</span><span class="n">cur_loc_edit_tbl_wdgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emit_wdgs_sgnls</span><span class="p">(</span><span class="n">cur_loc_edit_tbl_wdgs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_tbl_hist_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tbl</span><span class="p">,</span> <span class="n">tbl_list</span><span class="p">,</span> <span class="n">tbl_hdrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a table with one row.</span>
<span class="sd">        This method is used for creating tables in the history tab.</span>

<span class="sd">        :param tbl: A table.</span>
<span class="sd">        :type tbl: QTableWidget</span>
<span class="sd">        :param tbl_list: Table list.</span>
<span class="sd">        :type tbl_list: list</span>
<span class="sd">        :param tbl_hdrs: Table headers.</span>
<span class="sd">        :type tbl_hdrs: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">setColumnCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tbl_hdrs</span><span class="p">))</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setSelectionBehavior</span><span class="p">(</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">SelectItems</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QTableWidget</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setEditTriggers</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">NoEditTriggers</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setHorizontalHeaderLabels</span><span class="p">(</span><span class="n">tbl_hdrs</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">setRowCount</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tbl_list</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tbl_list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">QDateTime</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

                <span class="n">tbl_item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
                <span class="n">tbl_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="n">tbl</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">tbl_item</span><span class="p">)</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_add_tbl_mty_row_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tbl</span><span class="p">,</span> <span class="n">tbl_hdrs</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a row at the given position of a table with empty items.</span>

<span class="sd">        :param tbl: A table.</span>
<span class="sd">        :type tbl: QTableWidget</span>
<span class="sd">        :param tbl_hdrs: Table headers.</span>
<span class="sd">        :type tbl_hdrs: list</span>
<span class="sd">        :param m: A row number.</span>
<span class="sd">        :type m: int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">tbl_hdr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tbl_hdrs</span><span class="p">):</span>
            <span class="n">tbl_item</span> <span class="o">=</span> <span class="n">QTableWidgetItem</span><span class="p">()</span>
            <span class="n">tbl_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">setItem</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">tbl_item</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_upd_loc_tbl_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the corresponding item in the location table&#39;s current row</span>
<span class="sd">        with the values in the sender widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upd_tbl_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_upd_occ_tbl_item</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the corresponding item in the occurrence table&#39;s current row</span>
<span class="sd">        with the values in the sender widget.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upd_tbl_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_upd_tbl_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tbl</span><span class="p">,</span> <span class="n">tbl_wdgs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the corresponding item in the table&#39;s current row</span>
<span class="sd">        with the values in the sender widget.</span>

<span class="sd">        :param tbl: A table.</span>
<span class="sd">        :type tbl: QTableWidget</span>
<span class="sd">        :param tbl_wdgs: A list of table widgets.</span>
<span class="sd">        :type tbl_wdgs: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sndr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>

        <span class="n">wdg_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wdg_list</span><span class="p">([</span><span class="n">sndr</span><span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">tbl_wdgs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sndr</span><span class="p">)</span>

        <span class="n">tbl_item</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="n">tbl_item</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">,</span> <span class="n">wdg_data</span><span class="p">)</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">tbl_item</span><span class="o">.</span><span class="n">row</span><span class="p">())</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">resizeColumnsToContents</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_sel_row_up</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select one row up in a table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tbl</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sel_row_dwn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select one row down in a table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tbl</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_upd_loc_tbl_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the location table widgets according to the selected location</span>
<span class="sd">        table row.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>

        <span class="n">loc_met</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_cb</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_cb</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">loc_met</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_cb</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_swdg</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_cb</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">wdg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cur_loc_edit_tbl_wdgs</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">wdg</span><span class="p">)</span>
            <span class="n">wdg_data</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_set_wdg_data</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">wdg_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_upd_occ_tbl_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the occurrence table widgets according to the selected</span>
<span class="sd">        occurrence table row.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>

        <span class="n">occ_row_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_occ_row_list</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">wdg</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">wdg_data</span> <span class="o">=</span> <span class="n">occ_row_list</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_wdg_data</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">wdg_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_wdg_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wdg</span><span class="p">,</span> <span class="n">wdg_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets widget&#39;s data.</span>

<span class="sd">        :param wdg: A Widget.</span>
<span class="sd">        :type wdg: QWidget</span>
<span class="sd">        :param wdg_data: A widget data.</span>
<span class="sd">        :type wdg_data: QVariant</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">wdg_data</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">wdg_data</span><span class="o">.</span><span class="n">is_integer</span><span class="p">():</span>
                        <span class="n">wdg_data</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">)</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">):</span>
            <span class="n">wdg</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wdg</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">wdg_data</span><span class="p">:</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">setDate</span><span class="p">(</span><span class="n">wdg_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wdg</span><span class="o">.</span><span class="n">setDate</span><span class="p">(</span><span class="n">wdg</span><span class="o">.</span><span class="n">minimumDateTime</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_add_tbl_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a table row.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tbl</span><span class="p">()</span>
        <span class="n">tbl_hdrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tbl_hdrs</span><span class="p">()</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">insertRow</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">tbl</span><span class="o">.</span><span class="n">blockSignals</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add_tbl_mty_row_items</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="n">tbl_hdrs</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_tbl_row</span><span class="p">()</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">setSortingEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_del_tbl_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a row from a table.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tbl</span><span class="p">()</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rst_tbl_row</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets a current table row.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_cb_by_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_tbl_mand_cb_dict</span><span class="p">())</span>

        <span class="n">tbl_wdgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tbl_wdgs</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_rst_wdgs</span><span class="p">(</span><span class="n">tbl_wdgs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_emit_wdgs_sgnls</span><span class="p">(</span><span class="n">tbl_wdgs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rst_all_tbl_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Resets all table rows.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tbl</span><span class="p">()</span>

        <span class="n">curr_item</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">()):</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">setCurrentCell</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rst_tbl_row</span><span class="p">()</span>

        <span class="n">tbl</span><span class="o">.</span><span class="n">selectRow</span><span class="p">(</span><span class="n">curr_item</span><span class="o">.</span><span class="n">row</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_del_all_tbl_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tbl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes all table rows except the currently selected one.</span>

<span class="sd">        :param tbl: A table.</span>
<span class="sd">        :type tbl: QTableWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_tbl</span><span class="p">()</span>
        <span class="n">orig_m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">rowCount</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="n">orig_m</span><span class="p">:</span>
                <span class="n">tbl</span><span class="o">.</span><span class="n">removeRow</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_row_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tbl</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns data from the given table in the given row.</span>

<span class="sd">        :param tbl: A table.</span>
<span class="sd">        :type tbl: QTableWidget</span>
<span class="sd">        :param m: A row number.</span>
<span class="sd">        :type m: int</span>

<span class="sd">        :returns: Data from the given table in the given row.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="n">row_item</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">)</span>

            <span class="n">row_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">row_data</span>

    <span class="k">def</span> <span class="nf">_set_loc_tbl_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets data to the current row in the location table.</span>
<span class="sd">        New row is added if the current row is not empty.</span>

<span class="sd">        :param row_data: A data to be written. It has to have the same length</span>
<span class="sd">            as number of columns in the table.</span>
<span class="sd">        :type row_data: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span>

        <span class="n">curr_row_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_row_data</span><span class="p">(</span><span class="n">tbl</span><span class="p">,</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">curr_row_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loc_addrow_btn</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">tbl</span><span class="o">.</span><span class="n">currentRow</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tbl</span><span class="o">.</span><span class="n">columnCount</span><span class="p">()):</span>
            <span class="n">tbl</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">EditRole</span><span class="p">,</span> <span class="n">row_data</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_get_tbl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a table the sender works with.</span>

<span class="sd">        :returns: A table the sender works with.</span>
<span class="sd">        :rtype: QTableWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;occ_&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl</span>

    <span class="k">def</span> <span class="nf">_get_tbl_hdrs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a table headers the sender works with.</span>

<span class="sd">        :returns: A table headers the sender works with.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;occ_&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_tbl_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a table widgets the sender works with.</span>

<span class="sd">        :returns: A table widgets the sender works with.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;occ_&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">occ_tbl_wdg_hdr_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cur_loc_edit_tbl_wdgs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_cur_loc_edit_tbl_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of current location edit table widgets.</span>

<span class="sd">        :returns: A list of current location table widgets.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cur_loc_edit_tbl_wdgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_edit_met_swdg</span><span class="o">.</span><span class="n">currentWidget</span><span class="p">()</span>\
            <span class="o">.</span><span class="n">findChildren</span><span class="p">((</span><span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPlainTextEdit</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">cur_loc_edit_tbl_wdgs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_cur_loc_manual_tbl_wdgs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of current location manual table widgets.</span>

<span class="sd">        :returns: A list of current location table widgets.</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">cur_loc_manual_tbl_wdgs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loc_manual_swdg</span><span class="o">.</span><span class="n">currentWidget</span><span class="p">()</span>\
            <span class="o">.</span><span class="n">findChildren</span><span class="p">((</span><span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QPlainTextEdit</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QDateEdit</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">cur_loc_manual_tbl_wdgs</span>

    <span class="k">def</span> <span class="nf">_get_tbl_mand_cb_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a table mandatory combo box dictionary the sender works with.</span>

<span class="sd">        :returns: A table mandatory combo box dictionary the sender works with.</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;occ_&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_occ_mand_cb_dict</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loc_edit_met_cb_dict</span></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017 Norwegian Institute for Nature Research.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'0.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>